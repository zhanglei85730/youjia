{"version":3,"file":null,"sources":["../src/util.js","../src/ajax.pc.js","../src/jsonp.pc.js","../src/event.js","../src/request.js","../src/defer.js","../src/plugin.loop.js","../src/plugin.soon.js","../src/default-global-config.js","../src/natty-fetch.js"],"sourcesContent":["export const hasWindow = 'undefined' !== typeof window\nexport const hasConsole = 'undefined' !== typeof console\nexport const doc = hasWindow ? document : null\nexport const escape = encodeURIComponent\nexport const NULL = null\nexport const TRUE = true\nexport const FALSE = !TRUE\nexport const UNDEFINED = 'undefined'\nexport const EMPTY = ''\n\nconst toString = Object.prototype.toString\nconst ARRAY_TYPE = '[object Array]'\nconst OBJECT_TYPE = '[object Object]'\n\n/**\n * 伪造的`promise`对象\n * NOTE 伪造的promise对象要支持链式调用 保证和`new Promise`返回的对象行为一致\n *      dummyPromise.then().catch().finally()\n */\nexport const dummyPromise = {\n    dummy: TRUE\n}\n\ndummyPromise.then = dummyPromise['catch'] = () => {\n    // NOTE 这里用了剪头函数 不能用`return this`\n    return dummyPromise\n}\n\n/**\n * 判断是否是IE8~11, 不包含Edge\n * @returns {boolean}\n * @note IE11下 window.ActiveXObject的值很怪异, 所以需要追加 'ActiveXObject' in window 来判断\n */\nexport const isIE = hasWindow && (!!window.ActiveXObject || 'ActiveXObject' in window)\n\nexport function noop(v) {\n    return v\n}\n\n/**\n * 变换两个参数的函数到多个参数\n * @param  {Function} fn 基函数\n * @return {Function} 变换后的函数\n * @demo\n *      function add(x, y) { return x+y; }\n *      add = redo(add);\n *      add(1,2,3) => 6\n */\nexport function redo(fn) {\n    return function () {\n        var args = arguments\n        var ret = fn(args[0], args[1])\n        for (var i = 2, l = args.length; i < l; i++) {\n            ret = fn(ret, args[i])\n        }\n        return ret\n    }\n}\n\nconst random = Math.random\nconst floor = Math.floor\nexport function makeRandom() {\n    return floor(random() * 9e9)\n}\n\nconst absoluteUrlReg = /^(https?:)?\\/\\//\nexport function isAbsoluteUrl(url) {\n    return !!url.match(absoluteUrlReg)\n}\n\nconst relativeUrlReg = /^[\\.\\/]/\nexport function isRelativeUrl(url) {\n    return !!url.match(relativeUrlReg)\n}\n\nconst BOOLEAN = 'boolean'\nexport function isBoolean(v) {\n    return typeof v === BOOLEAN\n}\n\nconst STRING = 'string'\nexport function isString(v) {\n    return typeof v === STRING\n}\n\nconst FUNCTION = 'function'\nexport function isFunction(v) {\n    return typeof v === FUNCTION\n}\n\nexport function runAsFn(v) {\n    return isFunction(v) ? v() : v\n}\n\nconst NUMBER = 'number'\nexport function isNumber(v) {\n    return !isNaN(v) && typeof v === NUMBER\n}\n\nconst OBJECT = 'object'\nexport function isObject(v) {\n    return typeof v === OBJECT && v !== NULL\n}\n\nexport function isWindow(v) {\n    return v !== NULL && v === v.window\n}\n\n// 参考了zepto\nexport function isPlainObject(v) {\n    return v !== NULL && isObject(v) && !isWindow(v) && Object.getPrototypeOf(v) === Object.prototype\n}\n\nexport function isEmptyObject(v) {\n    let count = 0\n    for (let i in v) {\n        if (v.hasOwnProperty(i)) {\n            count++\n        }\n    }\n    return count === 0\n}\n\nexport function isArray(v) {\n    return toString.call(v) === ARRAY_TYPE\n}\n\n/**\n * 判断是否跨域\n * @type {Element}\n * @note 需要特别关注IE8~11的行为是不一样的!!!\n */\nlet originA\nif(doc) {\n    originA = doc.createElement('a')\n    originA.href = location.href\n}\nexport function isCrossDomain(url) {\n\n    let requestA = doc.createElement('a')\n    requestA.href = url\n\n    // 如果`url`的值不包含`protocol`和`host`(比如相对路径), 在标准浏览器下, 会自定补全`requestA`对象的`protocal`和`host`属性.\n    // 但在IE8~11下, 不会自动补全. 即`requestA.protocol`和`requestA.host`的值都是空的.\n    // 在IE11的不同小版本下, requestA.protocol的值有的是`:`, 有的是空字符串, 太奇葩啦!\n    if (__FALLBACK__) {\n        if (isIE && (requestA.protocol === ':' || requestA.protocol === '')) {\n            if (requestA.hostname === '') {\n                //alert(0)\n                return false\n            } else {\n                //alert('1:'+(originA.hostname !== requestA.hostname || originA.port !== requestA.port))\n                return originA.hostname !== requestA.hostname || originA.port !== requestA.port\n            }\n        }\n    }\n\n    // 标准浏览器\n    return originA.hostname !== requestA.hostname || originA.port !== requestA.port || originA.protocol !== requestA.protocol\n}\n\n/**\n * 对象扩展\n * @param  {Object} receiver\n * @param  {Object} supplier\n * @return {Object} 扩展后的receiver对象\n * @note 这个extend方法是定制的, 不要拷贝到其他地方用!!!\n * @note 这个extend方法是深拷贝方式的!!!\n */\nfunction _extend(receiver = {}, supplier = {}, deepCopy = FALSE) {\n    for (let key in supplier) {\n        // `supplier`中不是未定义的键 都可以执行扩展\n        if (supplier.hasOwnProperty(key) && supplier[key] !== undefined) {\n            if (deepCopy === TRUE) {\n                if (isArray(supplier[key])) {\n                    receiver[key] = [].concat(supplier[key])\n                } else if (isPlainObject(supplier[key])) {\n                    receiver[key] = extend({}, supplier[key])\n                } else {\n                    receiver[key] = supplier[key]\n                }\n            } else {\n                receiver[key] = supplier[key]\n            }\n        }\n    }\n    return receiver\n};\n\nconst extend = redo(_extend)\nexport {extend}\n\nexport function likeArray(v) {\n    if (!v) {\n        return false\n    }\n    return typeof v.length === NUMBER\n}\n\n/**\n *\n * @param v {Array|Object} 遍历目标对象\n * @param fn {Function} 遍历器 会被传入两个参数, 分别是`value`和`key`\n */\nexport function each(v, fn) {\n    let i, l\n    if (likeArray(v)) {\n        for (i = 0, l = v.length; i < l; i++) {\n            if (fn.call(v[i], v[i], i) === false) return\n        }\n    } else {\n        for (i in v) {\n            if (fn.call(v[i], v[i], i) === false) return\n        }\n    }\n}\n\n/**\n * 将对象的`键`排序后 返回一个新对象\n *\n * @param obj {Object} 被操作的对象\n * @returns {Object} 返回的新对象\n * @case 这个函数用于对比两次请求的参数是否一致\n */\nexport function sortPlainObjectKey(obj) {\n    let clone = {}\n    let key\n    let keyArray = []\n    for (key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            keyArray.push(key)\n            if (isPlainObject(obj[key])) {\n                obj[key] = sortPlainObjectKey(obj[key])\n            }\n        }\n    }\n    keyArray.sort()\n    for (let i=0, l=keyArray.length; i<l; i++) {\n        clone[keyArray[i]] = obj[keyArray[i]]\n    }\n    return clone\n}\n\nexport function serialize(params, obj, traditional, scope) {\n    let type, array = isArray(obj), hash = isPlainObject(obj)\n    each(obj, function(value, key) {\n        type = toString.call(value)\n        if (scope) {\n            key = traditional ? scope : scope + '[' + (hash || type == OBJECT_TYPE || type == ARRAY_TYPE ? key : '') + ']'\n        }\n\n        // 递归\n        if (!scope && array) {\n            params.add(value.name, value.value)\n        }\n        // recurse into nested objects\n        else if (type == ARRAY_TYPE || (!traditional && type == OBJECT_TYPE)) {\n            serialize(params, value, traditional, key)\n        } else {\n            params.add(key, value)\n        }\n    })\n}\n\n/**\n * 功能和`Zepto.param`一样\n * @param obj {Object}\n * @param traditional {Boolean}\n * @returns {string}\n * $.param({ foo: { one: 1, two: 2 }}) // \"foo[one]=1&foo[two]=2)\"\n * $.param({ ids: [1,2,3] })           // \"ids[]=1&ids[]=2&ids[]=3\"\n * $.param({ ids: [1,2,3] }, true)     // \"ids=1&ids=2&ids=3\"\n * $.param({ foo: 'bar', nested: { will: 'not be ignored' }})    // \"foo=bar&nested[will]=not+be+ignored\"\n * $.param({ foo: 'bar', nested: { will: 'be ignored' }}, true)  // \"foo=bar&nested=[object+Object]\"\n * $.param({ id: function(){ return 1 + 2 } })  // \"id=3\"\n */\nexport function param(obj, traditional) {\n    var params = []\n    params.add = (key, value) => {\n        if (isFunction(value)) value = value()\n        if (value == NULL) value = ''\n        params.push(escape(key) + '=' + escape(value))\n    }\n    serialize(params, obj, traditional)\n    return params.join('&').replace(/%20/g, '+')\n}\n\nexport function decodeParam(str) {\n    return decodeURIComponent(str.replace(/\\+/g, ' '))\n}\n\n// 给URL追加查询字符串\nexport function appendQueryString(url, obj, urlStamp, traditional) {\n    // 是否添加时间戳\n    if (urlStamp) {\n        obj[isBoolean(urlStamp) ? '_stamp' : urlStamp] = +new Date()\n    }\n    let queryString = param(obj, traditional)\n\n    if (queryString) {\n        return url + (~url.indexOf('?') ? '&' : '?') + queryString\n    } else {\n        return url\n    }\n}","import {\n    extend, appendQueryString, noop, isCrossDomain, isBoolean, param, isIE,\n    hasWindow, TRUE, FALSE, UNDEFINED, NULL\n} from './util'\n\nconst GET = 'GET'\nconst SCRIPT = 'script'\nconst XML = 'xml'\nconst JS0N = 'json' // NOTE 不能使用`JSON`，这里用数字零`0`代替了字母`O`\n\nconst xhrTester = UNDEFINED !== typeof XMLHttpRequest ? new XMLHttpRequest() : {}\nconst hasXDR = UNDEFINED !== typeof XDomainRequest\nconst fallback = hasWindow ? (!('withCredentials' in xhrTester) && hasXDR) : NULL\nconst supportCORS = hasWindow ? (('withCredentials' in xhrTester) || hasXDR) : NULL\n\n// minetype的简写映射\n// TODO 考虑是否优化\nconst acceptToRequestHeader = {\n    // IIS returns `application/x-javascript` 但应该不需要支持\n    '*':    '*/' + '*',\n    script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript',\n    json:   'application/json, text/json',\n    xml:    'application/xml, text/xml',\n    html:   'text/html',\n    text:   'text/plain'\n}\n\n// 设置请求头\n// 没有处理的事情：跨域时使用者传入的多余的Header没有屏蔽 没必要\n// - 请求方法是`POST`, `PUT`, `PATCH`时，推荐的最佳实战是将`Content-Type`设置为`application/json;utf-8`。\n//   而且服务端应该对HTTP请求主体做编码验证，当`Content-Type`的值不是`application/json`时，抛出415异常，\n//   即`unsupported media type`。\n// - 跨域情况下，如果请求头的`Content-Type`值不是`application/x-www-form-urlencoded, multipart/form-data, text/plain`，\n//   浏览器会先发送`OPTIONS`请求来询问服务端是否允许，此时应该直接返回`200`，表示允许。\n// - 使用`POST`方式时，如果不设置`Content-Type`，浏览器的默认值为`text/plain;charset=utf-8`。\n// - 关于请求动词的浏览器兼容性：即使是IE，兼容性都很棒\n// - PUT 和 PATCH 是不一样的，PUT替换整个数据，PATCH只修改局部数据 或 添加新的属性数据\n// - 好好看看：http://stackoverflow.com/questions/12320467/jquery-cors-content-type-options\nconst setHeaders = (xhr, options) => {\n    // IE下如果跨域 xhr对象是不允许设置自定义header的 也没有setRequestHeader方法\n    if (!xhr.setRequestHeader) {\n        return {}\n    }\n\n    const header = {\n        Accept: acceptToRequestHeader[options.accept]\n    }\n\n    // 如果没有跨域 则打该标识 业界通用做法\n    if (!isCrossDomain(options.url)) {\n        header['X-Requested-With'] = 'XMLHttpRequest'\n    }\n\n    // 如果POST方法，没有明确指定编码方式，默认urlencoded，\n    // TODO v3.x将去掉改处理！！！需要文档强调\n    if (options.method === 'POST' && !header['Content-Type']) {\n        header['Content-Type'] = 'application/x-www-form-urlencoded'\n    }\n\n    extend(header, options.header)\n\n    for (let key in header) {\n        xhr.setRequestHeader(key, header[key])\n    }\n\n    return header\n}\n\n// 绑定事件\nconst setEvents = (xhr, options, isCrossDomain) => {\n\n    let completeFn = function() {\n        if (xhr._completed) {\n            return\n        }\n        xhr._completed = true\n        //options.log && console.info('~loadend')\n        options.complete()\n        xhr._aborted = null\n        delete xhr._aborted\n    }\n\n    let onLoadFn = function() {\n\n        if (xhr._completed) {\n            return\n        }\n\n        let data = xhr.responseText\n\n        switch (options.accept) {\n            case JS0N:\n                try {\n                    data = JSON.parse(data)\n                } catch (e) {\n                    console.warn('The response can NOT be parsed to JSON object.', data)\n                }\n                break\n            case SCRIPT:\n                (1, eval)(data)\n                break\n            case XML:\n                data = xhr.responseXML\n                break\n            default:\n                break\n        }\n\n        options.success(data, xhr)\n        //C.log('complete after load')\n        completeFn()\n    }\n\n    let onErrorFn = function () {\n        if (xhr._completed) {\n            return\n        }\n        options.error(xhr.status, xhr)\n        //C.log('complete after error')\n        completeFn()\n    }\n\n    let abortFn = function() {\n        if (xhr._completed) {\n            return\n        }\n        options.abort()\n        completeFn()\n    }\n\n    // 如果是IE8/9 且 如果是跨域请求\n    if (fallback && isCrossDomain) {\n\n        // `XDomainRequest`实例是没有`onreadystatechange`方法的!!!\n        xhr.onload = onLoadFn\n    } else {\n        // readyState value:\n        //   0: UNSET 未初始化\n        //   1: OPENED\n        //   2: HEADERS_RECEIVED\n        //   3: LOADING\n        //   4: DONE 此时触发load事件\n        xhr.onreadystatechange = () => {\n\n            if (xhr._completed) {\n                return\n            }\n            //console.log('xhr.readyState', xhr.readyState, 'xhr.status', xhr.status, xhr)\n            if (xhr.readyState == 4) {\n\n                // 如果请求被取消(aborted) 则`xhr.status`会是0 所以不会进入`success`回调\n                if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {\n                    onLoadFn()\n                } else {\n                    // 因为取消时会先触发原生的`onreadystatechange`响应，后触发`onAbort`回调，所以\n                    // 如果请求被取消(aborted) 则`xhr.status`会是0 程序走到这里的时候，`xhr._aborted`状态是false，\n                    // 需要排除，不应该触发`error`回调\n                    !xhr._aborted && onErrorFn()\n                }\n            }\n        }\n    }\n\n    xhr.onerror = onErrorFn\n\n    // 重写`abort`方法\n    let originAbort = xhr.abort\n    xhr.abort = function() {\n        if (xhr._completed) {\n            return\n        }\n        xhr._aborted = true\n        // NOTE 直接调用`originAbort()`时 浏览器会报 `Illegal invocation` 错误\n\n        // 非IE浏览器才会真正的调用原生`abort`\n        // https://github.com/jias/natty-fetch/issues/27\n        if (!isIE) {\n            originAbort.call(xhr)\n        }\n\n        // `XDomainRequest`对象实例居然没有`onabort`方法\n        abortFn()\n    }\n\n    // IE9 bug\n    xhr.onprogress = xhr.ontimeout = noop\n}\n\nconst defaultOptions = {\n    url: '',\n    mark: {},\n    useMark: TRUE,\n    method: GET,\n    accept: '*',\n    data: NULL,\n    header: {},\n    withCredentials: NULL, // 根据`url`是否跨域决定默认值. 如果显式配置该值(必须是布尔值), 则个使用配置值\n    urlStamp: TRUE,\n    success: noop,\n    error: noop,\n    complete: noop,\n    abort: noop,\n    log: FALSE,\n    traditional: FALSE,\n    // postDataFormat: 'FORM'\n}\n\nexport default function ajax(options) {\n\n    options = extend({}, defaultOptions, options)\n\n    // 是否跨域\n    let isCD = isCrossDomain(options.url)\n\n    // H5版本\n    // `IE10+`和标准浏览器的`XMLHttpRequest`都原生支持跨域\n    let xhr = new XMLHttpRequest()\n\n    // `IE8/9`使用`XDomainRequest`来实现跨域, `IE10+`的`XMLHttpRequest`对象直接支持跨域\n    if (fallback && isCD) {\n        // NOTE `XDomainRequest`仅支持`GET`和`POST`两个方法\n        // 支持的事件有: onerror, onload, onprogress, ontimeout, 注意没有`onloadend`\n        // https://developer.mozilla.org/zh-CN/docs/Web/API/XDomainRequest\n        xhr = new XDomainRequest()\n    }\n\n    // 再高级的浏览器都有低级错误! 已经不能在相信了!\n    // MAC OSX Yosemite Safari上的低级错误: 一次`ajax`请求的`loadend`事件完成之后,\n    // 如果执行`xhr.abort()`, 居然还能触发一遍`abort`和`loadend`事件!!!\n    // `_completed`标识一次完整的请求是否结束, 如果已结束, 则不再触发任何事件\n    xhr._completed = FALSE\n\n    setEvents(xhr, options, isCD)\n\n    xhr.open(options.method, appendQueryString(\n        options.url,\n        extend({}, options.useMark ? options.mark : {}, options.method === GET ? options.data : {}),\n        options.urlStamp,\n        options.traditional\n    ))\n\n    // NOTE 生产环境的Server端, `Access-Control-Allow-Origin`的值一定不要配置成`*`!!! 而且`Access-Control-Allow-Credentials`应该是true!!!\n    // NOTE 如果Server端的`responseHeader`配置了`Access-Control-Allow-Origin`的值是通配符`*` 则前端`withCredentials`是不能使用true值的\n    // NOTE 如果Client端`withCredentials`使用了true值 则后端`responseHeader`中必须配置`Access-Control-Allow-Credentials`是true\n    if (!fallback) {\n        xhr.withCredentials = isBoolean(options.withCredentials) ? options.withCredentials : isCD\n    }\n    \n    // 设置requestHeader\n    const header = setHeaders(xhr, options)\n\n    let data\n\n    if (header['Content-Type'] && ~header['Content-Type'].indexOf('application/x-www-form-urlencoded')) {\n        data = param(options.data, options.traditional)\n    } else {\n        data = JSON.stringify(options.data)\n    }\n    \n    // 文档建议说 send方法如果不发送请求体数据 则null参数在某些浏览器上是必须的\n    xhr.send(options.method === GET ? NULL : data === NULL ? NULL : data)\n\n    return xhr\n}\n\najax.fallback = fallback\najax.supportCORS = supportCORS\n\n","import {appendQueryString, noop, extend, makeRandom, hasWindow, NULL, TRUE, FALSE} from './util'\nconst win = hasWindow ? window : NULL\nconst doc = hasWindow ? document : NULL\nconst SCRIPT = 'script'\nconst IE8 = hasWindow ? navigator.userAgent.indexOf('MSIE 8.0') > -1 : FALSE\n\nconst removeScript = (script) => {\n    if (IE8 && script.readyState) {\n        script.onreadystatechange = NULL\n    } else {\n        script.onerror = NULL\n    }\n    script.parentNode.removeChild(script)\n    script = NULL\n}\nlet head = NULL\nconst insertScript = (url, options) => {\n    let script = doc.createElement(SCRIPT)\n    script.type = 'text/javascript'\n    script.src = url\n    script.async = TRUE\n\n    if (options.crossOrigin) {\n      script.crossorigin = true\n    }\n\n    // 绑定`error`事件\n    if (IE8 && script.readyState) {\n        script.onreadystatechange = () => {\n            // IE8下script标签不支持`onerror`事件, 通过JSONP的执行顺序来模拟触发:\n            // 1:   script.readyState状态值为`loading`\n            // 2.1: 如果脚本加载成功, 浏览器就会先执行脚本内容, 即调用JSONP函数, 如: `jsonp2327905726()`,\n            //      (该函数执行之后会立即被设置成`null`值, 用于第3步的判断), JSONP函数执行完成后, 会进入第3步.\n            // 2.2: 如果脚本加载不成功, 也会进入第3步.\n            // 3:   无论脚本是否加载成功, `script.readyState`状态值都变化为`loaded`,\n            //      如果加载不成功, 可以通过判断JSONP函数一定是存在, 即可模拟`error`回调了.\n            if (script.readyState === 'loaded' && win[options.callbackName]) {\n                win[options.callbackName] = NULL\n                options.error()\n                options.complete()\n            }\n        }\n    } else {\n        script.onerror = (e) => {\n            win[options.callbackName] = NULL\n            options.error(e)\n            options.complete()\n        }\n    }\n\n    head = head || doc.getElementsByTagName('head')[0]\n    head.insertBefore(script, head.firstChild)\n    return script\n}\n\nconst defaultOptions = {\n    url: '',\n    mark: {},\n    useMark: TRUE,\n    data: {},\n    urlStamp: TRUE,\n    success: noop,\n    error: noop,\n    complete: noop,\n    log: FALSE,\n    flag: 'callback',\n    callbackName: 'jsonp{id}',\n    traditional: FALSE,\n    crossOrigin: FALSE\n}\n\nexport default function jsonp(options) {\n\n    options = extend({}, defaultOptions, options)\n\n    const callbackName = options.callbackName = options.callbackName.replace(/\\{id\\}/, makeRandom())\n\n    const originComplete = options.complete\n\n    let script\n\n    // 二次包装的`complete`回调\n    options.complete = () => {\n        // 删除脚本\n        removeScript(script)\n        originComplete()\n    }\n\n    // 成功回调\n    win[callbackName] = (data) => {\n        // JSONP函数需要立即删除 用于`IE8`判断是否触发`onerror`\n        win[callbackName] = NULL\n        options.success(data)\n        options.complete()\n    }\n\n    // 生成`url`\n    let url = appendQueryString(\n        options.url,\n        extend({[options.flag]: callbackName}, options.useMark ? options.mark : {}, options.data),\n        options.urlStamp,\n        options.traditional\n    )\n\n    // 插入脚本\n    script = insertScript(url, options)\n    \n    return {\n        abort() {\n            // 覆盖成功回调为无数据处理版本\n            win[callbackName] = () => {\n                win[callbackName] = NULL\n            }\n            removeScript(script)\n        }\n    }\n}\n","const PREFIX = '_'\nfunction rename (type) {\n    return PREFIX + type\n}\n\nexport default {\n    on: function () {\n        const args = arguments\n        if (typeof args[0] === 'string' && typeof args[1] === 'function') {\n            const type = rename(args[0])\n            this[type]  = this[type] || []\n            this[type].push(args[1])\n        } else if (typeof args[0] === 'object') {\n            const hash = args[0]\n            for (let i in hash) {\n                this.on(i, hash[i])\n            }\n        }\n    },\n    off: function (type, fn) {\n        type = rename(type)\n        if (!fn) {\n            delete this[type]\n        } else {\n            const fns = this[type]\n            fns.splice(fns.indexOf(fn), 1)\n            if (!this[type].length) {\n                delete this[type]\n            }\n        }\n    },\n    // @param {array} args\n    fire: function (type, args, context) {\n        const fns = this[rename(type)]\n        if (!fns) return 'NO_EVENT'\n        for (let i=0, fn; fn = fns[i]; i++) {\n            fn.apply(context || this, [].concat(args))\n        }\n    },\n    hasEvent: function (type) {\n        return !!this[rename(type)]\n    }\n}","import {extend, NULL, TRUE, FALSE, isAbsoluteUrl, isRelativeUrl, EMPTY} from './util'\nimport ajax from './__AJAX__'\nimport jsonp from './__JSONP__'\n\nlet rid = 0\nconst getRid = function () {\n    return rid++\n}\n\nexport default class Request {\n\n    constructor(apiInstance) {\n\n        const {_path, config, api, contextId} = apiInstance\n\n        this._apiInstance = apiInstance\n\n        // 单次请求实例的id，用于从`api`实例的`_pendingList`中删除请求实例\n        this._rid = [contextId, _path, getRid()].join('-')\n\n        this._path = _path\n        this.config = config\n        this.storage = api.storage\n        this.contextId = contextId\n\n        // 工作状态\n        this.pending = FALSE\n        this._requester = NULL\n    }\n\n    // 发起网络请求 返回一个Promise实例\n    send({vars, onSuccess, onError, onComplete}) {\n\n        this.vars = vars\n\n        this.onSuccess = onSuccess\n        this.onError = onError\n        this.onComplete = onComplete\n\n        const {config} = this\n\n        // 调用 willFetch 钩子\n        config.willFetch(vars, config, 'remote')\n\n        // 等待状态在此处开启 在相应的`requester`的`complete`回调中关闭\n        this.pending = TRUE\n\n        // 创建请求实例requester\n        if (config.customRequest) {\n            // 使用私有的request方法\n            this._requester = config.customRequest(vars, config, (isSuccess, response) => {\n              // 当isSuccess为false时，response的结构应该是 {message: 'xxx'}\n              isSuccess ? this.processResponse(response) : this.onError(response)\n            })\n        } else if (config.jsonp) {\n            this._requester = this.jsonp()\n        } else {\n            this._requester = this.ajax()\n        }\n\n        // 超时处理\n        if (0 !== config.timeout) {\n            setTimeout(() => {\n                if (this.pending) {\n                    // 取消请求\n                    this.abort()\n\n                    const error = {\n                        timeout: TRUE,\n                        message: 'Timeout By ' + config.timeout + 'ms.'\n                    }\n\n                    this.onError(error)\n                }\n            }, config.timeout)\n        }\n    }\n\n    // 处理结构化的响应数据\n    processResponse(response) {\n        const {config, vars} = this\n        // 调用 didFetch 钩子函数\n        config.didFetch(vars, config)\n\n        // 非标准格式数据的预处理\n        response = config.fit(response, vars)\n\n        if (response.success) {\n            // 数据处理\n            const content = config.process(response.content, vars)\n            this.onSuccess(content)\n        } else {\n            const error = extend({\n                message: '`success` is false, ' + this._path\n            }, response.error)\n            // NOTE response是只读的对象!!!\n            this.onError(error)\n        }\n    }\n\n    // 获取正式接口的完整`url`\n    // @param config {Object}\n    getFinalUrl() {\n        const {config, vars} = this\n        let url = config.mock ? config.mockUrl : config.url\n        if (!url) return EMPTY\n        const prefixKey = config.mock ? 'mockUrlPrefix' : 'urlPrefix'\n        const suffixKey = config.mock ? 'mockUrlSuffix' : 'urlSuffix'\n        const prefix = config[prefixKey] && !isAbsoluteUrl(url) && !isRelativeUrl(url) ? config[prefixKey] : EMPTY\n        const suffix = config[suffixKey] ? config[suffixKey]: EMPTY\n\n        url = prefix + url + suffix\n\n        // 如果是RESTFul API，填充所有的':x'参数\n        if (config.rest) {\n            const restData = vars.data\n            for (let param in restData) {\n                if (~param.indexOf(':')) {\n                    url = url.replace(new RegExp('\\\\/' + param), '/' + restData[param])\n                    delete restData[param]\n                }\n            }\n        }\n\n        return url\n    }\n\n    // 发起Ajax请求\n    // @returns {Object} xhr对象实例\n    ajax() {\n        const {config, vars} = this\n\n        const url = this.getFinalUrl()\n\n        return ajax({\n            traditional: config.traditional,\n            urlStamp: config.urlStamp,\n            mark: vars.mark,\n            useMark: config.mark,\n            log: config.log,\n            url: url,\n            method: config.method,\n            data: vars.data,\n            header: config.header,\n            withCredentials: config.withCredentials,\n            // 强制约定json\n            accept: 'json',\n            success: response => {\n                this.processResponse(response)\n            },\n            error: status => {\n                // 如果跨域使用了自定义的header，且服务端没有配置允许对应的header，此处status为0，目前无法处理。\n                const error = {\n                    status,\n                    message: `Error(status ${status}) in request for ${vars.mark._api}(${url})`\n                }\n                this.onError(error)\n            },\n            complete: () => {\n                this.onComplete()\n                this.pending = FALSE\n                this._requester = NULL\n            }\n        })\n    }\n\n    // 发起jsonp请求\n    // @returns {Object} 带有abort方法的对象\n    jsonp() {\n        const {config, vars} = this\n\n        const url = this.getFinalUrl()\n\n        return jsonp({\n            traditional: config.traditional,\n            log: config.log,\n            mark: vars.mark,\n            useMark: config.mark,\n            url: url,\n            data: vars.data,\n            urlStamp: config.urlStamp,\n            flag: config.jsonpFlag,\n            callbackName: config.jsonpCallbackName,\n            crossOrigin: config.jsonpCrossOrigin,\n            success: response => {\n                this.processResponse(response)\n            },\n            error: () => {\n                const error = {\n                    message: `Not accessable JSONP in request for ${vars.mark._api}(${url})`\n                }\n                this.onError(error)\n            },\n            complete: () => {\n                this.onComplete()\n                this.pending = FALSE\n                this._requester = NULL\n            }\n        })\n    }\n\n    // 取消请求\n    abort() {\n        if (this._requester) {\n            this._requester.abort()\n        }\n    }\n}","export default class Defer {\n  constructor(Promise) {\n    const t = this\n    t.promise = new Promise(function (resolve, reject) {\n      t._resolve = resolve\n      t._reject = reject\n    })\n  }\n\n  resolve(value) {\n    this._resolve.call(this.promise, value)\n  }\n\n  reject(reason) {\n    this._reject.call(this.promise, reason)\n  }\n}","import {isNumber, noop, TRUE, FALSE, NULL} from './util'\n\n/**\n * 创建轮询支持\n * @param api {Function} 需要轮询的函数\n */\nexport default function() {\n    const {api} = this\n\n    api.loop = (options, resolveFn = noop, rejectFn = noop) => {\n        if (!options.duration || !isNumber(options.duration)) {\n            throw new Error('Illegal `duration` value for `startLoop` method.')\n        }\n\n        let loopTimer = NULL\n\n        let stop = () => {\n            clearTimeout(loopTimer)\n            loopTimer = NULL\n            stop.looping = FALSE\n        }\n\n        let sleepAndRequest = () => {\n            stop.looping = TRUE\n            api(options.data).then(resolveFn, rejectFn)\n            loopTimer = setTimeout(() => {\n                sleepAndRequest()\n            }, options.duration)\n        }\n\n        sleepAndRequest()\n        \n        return stop\n    }\n}\n","import {noop, isEmptyObject, sortPlainObjectKey, FALSE, TRUE, hasConsole} from './util'\n\nexport default function() {\n    const {api} = this\n    api.soon = (data, successFn = noop, errorFn = noop) => {\n        const vars = this.makeVars(data)\n\n        // 先尝试用`storage`数据快速响应\n        if (api.storageUseable) {\n\n            const result = api.storage.has(vars.queryString)\n\n            if (result.has) {\n                successFn({\n                    fromStorage: TRUE,\n                    content: result.value\n                })\n            }\n        }\n\n        // 再发起网络请求(内部会更新`storage`)\n        this.send(vars).then(content => {\n            successFn({\n                fromStorage: FALSE,\n                content\n            })\n        }, error => {\n            errorFn(error)\n        })['catch'](function (e) {\n            hasConsole && console.error(e)\n        })\n    }\n}","import {noop, NULL, TRUE, FALSE, EMPTY, hasWindow} from './util'\n\nconst config = {\n\n    // 默认参数\n    data: {},\n\n    // 请求完成钩子函数\n    didFetch: noop,\n\n    // 预处理回调\n    fit: noop,\n\n    // 自定义header, 只针对非跨域的ajax有效, 跨域时将忽略自定义header\n    header: {},\n\n    // 是否忽律接口自身的并发请求\n    ignoreSelfConcurrent: FALSE,\n\n    // 有两种格式配置`jsonp`的值\n    // {Boolean}\n    // {Array} eg: [TRUE, 'cb', 'j{id}']\n    jsonp: FALSE,\n\n    // 是否在`jsonp`的`script`的标签上加`crossorigin`属性\n    jsonpCrossOrigin: FALSE,\n\n    // 是否开启log信息\n    log: FALSE,\n\n    // 非GET方式对JSONP无效\n    method: 'GET',\n\n    // 是否开启mock模式\n    mock: FALSE,\n\n    mockUrl: EMPTY,\n\n    // 全局`mockUrl`前缀\n    mockUrlPrefix: EMPTY,\n\n    // 全局`mockUrl`后缀\n    mockUrlSuffix: EMPTY,\n\n    // 成功回调\n    process: noop,\n\n    // 私有Promise对象, 如果不想用浏览器原生的Promise对象的话\n    Promise: hasWindow ? window.Promise : NULL,\n\n    // 是否是rest风格\n    rest: FALSE,\n\n    // 默认不执行重试\n    retry: 0,\n\n    // 使用已有的request方法\n    customRequest: NULL,\n\n    // 0表示不启动超时处理\n    timeout: 0,\n\n    // http://zeptojs.com/#$.param\n    traditional: FALSE,\n\n    url: EMPTY,\n\n    // 全局`url`前缀\n    urlPrefix: EMPTY,\n\n    // 是否在`url`上添加时间戳, 用于避免浏览器的304缓存\n    urlStamp: TRUE,\n\n    // 全局`url`后缀\n    urlSuffix: EMPTY,\n\n    // TODO 文档中没有暴露\n    withCredentials: NULL,\n\n    // 请求之前调用的钩子函数\n    willFetch: noop,\n\n    // 扩展: storage\n    storage: FALSE,\n\n    // 插件，已内置两种\n    // plugins: [\n    //     nattyFetch.plugin.loop\n    //     nattyFetch.plugin.soon\n    // ]\n    plugins: FALSE,\n}\n\nexport default config","import nattyStorage from 'natty-storage'\nimport * as util from './util'\n\nconst {\n    extend, runAsFn, isBoolean,\n    isArray, isFunction, sortPlainObjectKey, isEmptyObject,\n    isPlainObject, dummyPromise,\n    isString, NULL, TRUE, FALSE, hasConsole\n} = util\n\nimport Request from './request'\nimport ajax from './__AJAX__'\nimport Defer from './defer'\nimport event from './event'\n\n// 内置插件\nimport pluginLoop from './plugin.loop'\nimport pluginSoon from './plugin.soon'\n\n// 全局默认配置\nimport defaultGlobalConfig from './default-global-config'\n\n// 随`setGlobal`方法而变化的运行时全局配置\nlet runtimeGlobalConfig = extend({}, defaultGlobalConfig)\n\nclass API {\n    constructor(path, options, contextConfig, contextId) {\n        this._path = path\n\n        this.contextConfig = contextConfig\n\n        this.contextId = contextId\n\n        // 进行中的请求列队\n        this._pendingList = []\n\n        this.storage = NULL\n\n        const config = this.config = this.processAPIOptions(options)\n\n        // `api`的实现\n        // @param data {Object|Function}\n        // @returns {Object} Promise Object\n        this.api = (data) => {\n\n            // 处理列队中的请求\n            if (this._pendingList.length) {\n                // 是否忽略自身的并发请求\n                if (config.ignoreSelfConcurrent) {\n                    return dummyPromise\n                }\n                // 是否取消上一个请求\n                if (config.overrideSelfConcurrent) {\n                    this._pendingList[0].abort()\n                }\n            }\n\n            const vars = this.makeVars(data)\n\n            if (this.api.storageUseable) {\n                const result = this.api.storage.has(vars.queryString)\n                if (result.has) {\n                    return new config.Promise(resolve => {\n                        resolve(result.value)\n                    })\n                } else {\n                    return config.retry === 0 ? this.send(vars) : this.sendWithRetry(vars)\n                }\n            } else {\n                return config.retry === 0 ? this.send(vars) : this.sendWithRetry(vars)\n            }\n        }\n\n        this.api.config = config\n\n        this.api.hasPending = () => {\n            return !!this._pendingList.length\n        }\n\n        // 要删除的方法，这个地方是`v2.3.0`版本之前都存在的设计错误，因为：\n        // io.get().then(...) 发送第一次\n        // io.get().then(...) 发送第二次\n        // io.get.abort()     取消哪一次? 并发情况复杂的业务，结果不明确。\n        this.api.abort = () => {\n            hasConsole && console.warn('`abort` method will be deleted later!')\n            for (let i=0, l=this._pendingList.length; i<l; i++) {\n                this._pendingList[i].abort()\n            }\n        }\n\n        this.initStorage()\n\n        // 启动插件\n        let plugins = isArray(config.plugins) ? config.plugins : []\n\n        for (let i=0, l=plugins.length; i<l; i++) {\n            isFunction(plugins[i]) && plugins[i].call(this, this)\n        }\n    }\n\n    // @param {Object} 一次独立的请求数据\n    makeVars(data) {\n        const {config} = this\n        // 每次请求私有的相关数据\n        const vars = {\n            // `url`中的标记\n            mark: {\n                _api: this._path,\n                _mock: config.mock\n            }\n        }\n\n        // `data`必须在请求发生时实时创建\n        // 另外，将数据参数存在私有标记中, 方便API的`process`方法内部使用\n        data = extend({}, runAsFn(config.data), runAsFn(data))\n\n        // 承载请求参数数据\n        vars.data = data\n\n        // 根据`data`创建`storage`查询用的`key`\n        if (this.api.storageUseable) {\n            vars.queryString = isEmptyObject(data) ? 'no-query-string' : JSON.stringify(sortPlainObjectKey(data))\n        }\n\n        return vars\n    }\n\n    // 发送真正的网络请求\n    send(vars) {\n        const {config} = this\n\n        // 每次请求都创建一个请求实例\n        const request = new Request(this)\n\n        this._pendingList.push(request)\n\n        const defer = new Defer(config.Promise)\n\n        request.send({\n            vars,\n            onSuccess: content => {\n                if (this.api.storageUseable) {\n                    this.api.storage.set(vars.queryString, content)\n                }\n                defer.resolve(content)\n                event.fire('g.resolve', [content, config], config)\n                event.fire(this.contextId + '.resolve', [content, config], config)\n            },\n            onError: error => {\n                defer.reject(error)\n                event.fire('g.reject', [error, config, vars], config)\n                event.fire(this.contextId + '.reject', [error, config, vars], config)\n            },\n            onComplete: () => {\n                let indexToRemove\n                for (let i=0, l=this._pendingList.length; i<l; i++) {\n                    if (this._pendingList[i] === request) {\n                        indexToRemove = i\n                        break\n                    }\n                }\n                indexToRemove !== undefined && this._pendingList.splice(indexToRemove, 1)\n            }\n        })\n\n        return defer.promise\n    }\n\n    sendWithRetry(vars) {\n        const {config} = this\n\n        return new config.Promise((resolve, reject) => {\n\n            let retryTime = 0\n            const sendOneTime = () => {\n                // 更新的重试次数\n                vars.mark._retryTime = retryTime\n                this.send(vars).then(content => {\n                    resolve(content)\n                }, error => {\n                    if (retryTime === config.retry) {\n                        reject(error)\n                    } else {\n                        retryTime++\n                        sendOneTime()\n                    }\n                })\n            }\n            sendOneTime()\n        })\n    }\n\n    // 处理API的配置\n    // @param options {Object}\n    processAPIOptions(options) {\n\n        // 插件是不能覆盖的, 应该追加\n        const plugins = [].concat(this.contextConfig.plugins || [], options.plugins || [])\n\n        const config = extend({}, this.contextConfig, options, {\n            plugins\n        })\n\n        // 按照[boolean, callbackKeyWord, callbackFunctionName]格式处理\n        if (isArray(options.jsonp)) {\n            config.jsonp = isBoolean(options.jsonp[0]) ? options.jsonp[0] : FALSE\n            // 这个参数只用于jsonp\n            if (config.jsonp) {\n                config.jsonpFlag = options.jsonp[1]\n                config.jsonpCallbackName = options.jsonp[2]\n            }\n        }\n\n        // 配置自动增强 如果`url`的值有`.jsonp`结尾 则认为是`jsonp`请求\n        // NOTE jsonp是描述正式接口的 不影响mock接口!!!\n        if (!config.mock && !!config.url.match(/\\.jsonp(\\?.*)?$/)) {\n            config.jsonp = TRUE\n        }\n\n        return config\n    }\n\n    // 初始化缓存对象\n    initStorage() {\n        const {config} = this\n\n        // 简易开启缓存的写法\n        if (config.storage === TRUE) {\n            config.storage = {\n                type: 'variable'\n            }\n        }\n\n        // 综合判断缓存是不是可以启用\n        this.api.storageUseable = isPlainObject(config.storage)\n            && (config.method === 'GET' || config.jsonp)\n            && (\n                nattyStorage.supportStorage\n                && (\n                    ['localStorage', 'sessionStorage'].indexOf(config.storage.type) > -1\n                    || config.storage.type === 'variable'\n                )\n            )\n\n        // 创建缓存实例\n        if (this.api.storageUseable) {\n            // 当使用`localStorage`时, 强制指定`key`值。如果没指定, 抛错!\n            // 当使用`variable`或`sessionStorage`时, 如果没指定`key`, 则自动生成内部`key`\n            // !!!为什么在使用`localStorage`时必须指定`key`值???\n            // !!!因为当key发生变化时, `localStorage`很容易产生死数据, 必须强制开发者有意识的去维护`key`值\n            if (config.storage.type === 'localStorage') {\n                if (!config.storage.hasOwnProperty('key') || !config.storage.key) {\n                    throw new Error('`key` is required when `storage.type` is `localStorage`.')\n                }\n            } else {\n                config.storage.key = config.storage.key || [this.contextId, this._path].join('_')\n            }\n\n            // `key`和`tag`的选择原则:\n            // `key`只选用相对稳定的值, 减少因为`key`的改变而增加的残留缓存\n            // 经常变化的值用于`tag`, 如一个接口在开发过程中可能使用方式不一样, 会在`jsonp`和`get`之间切换。\n            this.api.storage = nattyStorage(extend({}, config.storage, {\n                tag: [\n                    config.storage.tag,\n                    config.jsonp ? 'jsonp' : config.method,\n                    config.url\n                ].join('_') // 使用者的`tag`和内部的`tag`, 要同时生效\n            }))\n        }\n    }\n}\n\nconst context = (function () {\n    let count = 0\n\n    return function(contextId, options) {\n\n        if (isString(contextId)) {\n            options = options || {}\n        } else {\n            options = contextId || {}\n            contextId = 'c' + count++\n        }\n\n        const storage = nattyStorage({\n            type: 'variable',\n            key: contextId\n        })\n\n        const ctx = {}\n\n        ctx.api = storage.get()\n\n        ctx._contextId = contextId\n\n        // 插件是不能覆盖的, 应该追加\n        let plugins = [].concat(runtimeGlobalConfig.plugins || [], options.plugins || [])\n\n        ctx._config = extend({}, runtimeGlobalConfig, options, {\n            plugins\n        })\n\n        // 创建api\n        // @param namespace {String} optional\n        // @param APIs {Object} 该`namespace`下的`api`配置\n        ctx.create = function(namespace, APIs) {\n            let hasNamespace = arguments.length === 2 && isString(namespace)\n\n            if (!hasNamespace) {\n                APIs = namespace\n            }\n\n            for (let path in APIs) {\n                storage.set(\n                    hasNamespace ? namespace + '.' + path : path,\n                    new API(\n                        hasNamespace ? namespace + '.' + path : path,\n                        runAsFn(APIs[path]),\n                        ctx._config,\n                        contextId\n                    ).api\n                )\n            }\n\n            ctx.api = storage.get()\n        }\n\n        // 绑定上下文事件\n        ctx.on = function(name, fn) {\n            if (!isFunction(fn)) return\n            event.on(ctx._contextId + '.' + name, fn)\n            return ctx\n        }\n\n        return ctx\n    }\n})()\n\nconst nattyFetch = {}\n\n// 简易接口\n// @param options\nnattyFetch.create = function (options) {\n    return new API('nattyFetch', runAsFn(options), defaultGlobalConfig, 'global').api\n}\n\nextend(nattyFetch, {\n    onlyForModern: !__FALLBACK__,\n    version: '__VERSION__',\n    _util: util,\n    _event: event,\n    _ajax: ajax,\n    context,\n\n    // 执行全局配置\n    // @param options\n    setGlobal(options) {\n        runtimeGlobalConfig = extend({}, defaultGlobalConfig, options)\n        return this\n    },\n\n    // 获取全局配置\n    // @param property {String} optional\n    // @returns {*}\n    getGlobal(property) {\n        return property ? runtimeGlobalConfig[property] : runtimeGlobalConfig\n    },\n\n    // 绑定全局事件\n    on(name, fn) {\n        if (!isFunction(fn)) return\n        event.on('g.' + name, fn)\n        return this\n    },\n\n    // 插件名称空间\n    plugin: {\n        loop: pluginLoop,\n        soon: pluginSoon\n    }\n})\n\n// 内部直接将运行时的全局配置初始化到默认值\nnattyFetch.setGlobal(defaultGlobalConfig)\n\nexport default nattyFetch"],"names":["noop","v","redo","fn","args","arguments","ret","i","l","length","makeRandom","floor","random","isAbsoluteUrl","url","match","absoluteUrlReg","isRelativeUrl","relativeUrlReg","isBoolean","BOOLEAN","isString","STRING","isFunction","FUNCTION","runAsFn","isNumber","isNaN","NUMBER","isObject","OBJECT","NULL","isWindow","window","isPlainObject","Object","getPrototypeOf","prototype","isEmptyObject","let","count","hasOwnProperty","isArray","toString","call","ARRAY_TYPE","isCrossDomain","requestA","doc","createElement","href","isIE","protocol","originA","hostname","port","_extend","receiver","supplier","deepCopy","FALSE","key","undefined","TRUE","concat","extend","likeArray","each","sortPlainObjectKey","obj","clone","keyArray","push","sort","serialize","params","traditional","scope","type","array","hash","value","OBJECT_TYPE","add","name","param","escape","join","replace","decodeParam","str","decodeURIComponent","appendQueryString","urlStamp","Date","queryString","indexOf","ajax","options","defaultOptions","isCD","xhr","XMLHttpRequest","fallback","XDomainRequest","_completed","setEvents","open","method","useMark","mark","GET","data","withCredentials","const","header","setHeaders","JSON","stringify","send","jsonp","script","callbackName","originComplete","complete","removeScript","win","success","flag","insertScript","abort","rename","PREFIX","hasWindow","hasConsole","console","document","encodeURIComponent","UNDEFINED","EMPTY","dummyPromise","dummy","then","ActiveXObject","Math","location","SCRIPT","XML","JS0N","xhrTester","hasXDR","supportCORS","acceptToRequestHeader","*","json","xml","html","text","setRequestHeader","Accept","accept","completeFn","_aborted","onLoadFn","responseText","parse","e","warn","eval","responseXML","onErrorFn","error","status","abortFn","onload","onreadystatechange","readyState","onerror","originAbort","onprogress","ontimeout","log","IE8","navigator","userAgent","parentNode","removeChild","head","src","async","crossOrigin","crossorigin","getElementsByTagName","insertBefore","firstChild","rid","getRid","Request","apiInstance","_path","config","api","contextId","this","_apiInstance","_rid","storage","pending","_requester","ref","vars","onSuccess","onError","onComplete","willFetch","customRequest","isSuccess","response","processResponse","timeout","setTimeout","this$1","message","didFetch","fit","content","process","getFinalUrl","mock","mockUrl","prefixKey","suffixKey","prefix","suffix","rest","restData","RegExp","jsonpFlag","jsonpCallbackName","jsonpCrossOrigin","Defer","Promise","t","promise","resolve","reject","_resolve","_reject","reason","on","off","fns","splice","fire","context","apply","hasEvent","loop","resolveFn","rejectFn","duration","Error","loopTimer","stop","clearTimeout","looping","sleepAndRequest","soon","successFn","errorFn","makeVars","storageUseable","result","has","fromStorage","ignoreSelfConcurrent","mockUrlPrefix","mockUrlSuffix","retry","urlPrefix","urlSuffix","plugins","runtimeGlobalConfig","defaultGlobalConfig","API","path","contextConfig","_pendingList","processAPIOptions","overrideSelfConcurrent","sendWithRetry","hasPending","initStorage","_api","_mock","request","defer","set","event","indexToRemove","retryTime","sendOneTime","_retryTime","nattyStorage","supportStorage","tag","ctx","get","_contextId","_config","create","namespace","APIs","hasNamespace","nattyFetch","onlyForModern","version","_util","util","_event","_ajax","setGlobal","getGlobal","property","plugin","pluginLoop","pluginSoon"],"mappings":"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"}
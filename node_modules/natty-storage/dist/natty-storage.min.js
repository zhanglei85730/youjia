/*! natty-storage.min.js v2.0.1 | MIT License | fushan | https://github.com/jias/natty-storage */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.nattyStorage=e()}(this,function(){"use strict";function t(t){return t=window[t],{set:function(e,i){t.setItem(e,JSON.stringify(i))},get:function(e){var i=t.getItem(e);if(!i)return y;try{i=JSON.parse(i)}catch(t){}return i},remove:function(e){t.removeItem(e)}}}function e(){var t=K;return{set:function(e,i){t[e]=i},get:function(e){return e in t?t[e]:y},remove:function(e){delete t[e]}}}function i(t){return t.split(v).reverse().join(v)}function r(t){var e;if(-1===t.indexOf("\\."))e=t.split(".");else{e=i(t).split(/\.(?!\\)/).reverse();for(var r=0,n=e.length;r<n;r++)e[r]=i(e[r].replace(/\.\\/g,"."))}return e}function n(t,e,i){for(var n=r(t),a=i;n.length;){var o=n.shift();if(n.length)a[o]=a[o]||{},a=a[o];else{if(!_(a))throw new Error("Cannot create property `"+o+"` on non-object value, path:`"+t+"`");a[o]=e}}return i}function a(t,e,i){if(!0===(i=i||!1)||-1===t.indexOf("."))return e[t];for(var n=r(t);n.length;){if("object"!=typeof(e=a(n.shift(),e,!0))||e===D){n.length&&(e=D);break}}return e}function o(t,e,i){if(i=i||-1===t.indexOf("."))return e.hasOwnProperty(t);for(var n=r(t);n.length;){var o=n.shift(),s=e.hasOwnProperty(o);if(!s||!n.length)return s;if(e=a(o,e,!0),!_(e))return w}}function s(t,e){for(var i=r(t),n=e;i.length;){var a=i.shift();i.length?(n[a]=n[a]||{},n=n[a]):delete n[a]}return e}var h="undefined"!=typeof window,c="undefined"!=typeof console,u=function(t){return"object"==typeof t&&null!==t},f=function(t){return null!==t&&t===t.window},_=function(t){return null!==t&&u(t)&&!f(t)&&Object.getPrototypeOf(t)===Object.prototype},d=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},l=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});for(var i in e)e.hasOwnProperty(i)&&e[i]!==undefined&&(d(e[i])?t[i]=[].concat(e[i]):_(e[i])?t[i]=l({},e[i]):t[i]=e[i]);return t},g=function(t){return function(){for(var e=arguments,i=t(e[0],e[1]),r=2,n=e.length;r<n;r++)i=t(i,e[r]);return i}}(l),p=function(){},y=null,v="",k=!0,w=!k,D=undefined,m=function(){if(!h)return w;if("object"!=typeof localStorage)return w;var t=k;try{var e="__nstest__";localStorage.setItem(e,e),t=localStorage.getItem(e)===e,localStorage.removeItem(e)}catch(e){t=w}return t}(),E={type:"variable",key:v,tag:v,duration:0,until:0},b=function(i){if(void 0===i&&(i={}),this.config=g({},E,i),!this.config.key)throw new Error("`key` is required when creating a storage!");this._storage="variable"!==this.config.type&&m?t(this.config.type):e(),this._CHECK_KEY="NSCheck:"+this.config.key,this._DATA_KEY="NSData:"+this.config.key,this._createStamp=+new Date,this._backupData={},this._checkData=this._storage.get(this._CHECK_KEY),this._isNew=this._checkData===y};b.prototype._lazyInit=function(){this._isNew||this.isOutdated()?this._storage.set(this._DATA_KEY,this._data={}):(this._data=this._storage.get(this._DATA_KEY),this._data===y&&this._storage.set(this._DATA_KEY,this._data={})),this._storage.set(this._CHECK_KEY,this._checkData={key:this.config.key,tag:this.config.tag,lastUpdate:this._createStamp,duration:this.config.duration,until:this.config.until})},b.prototype.isOutdated=function(){if(this.config.tag&&this.config.tag!==this._checkData.tag)return k;var t=+new Date;return this._checkData.duration&&t-this._checkData.lastUpdate>this._checkData.duration?k:this._checkData.until&&t>this._checkData.until?k:w},b.prototype.set=function(t,e){this._data||this._lazyInit(),this._backupData=this._data;try{n(t,e,this._data),this._storage.set(this._DATA_KEY,this._data)}catch(t){throw this._storage.set(this._DATA_KEY,this._data=this._backupData),new Error(t)}},b.prototype.get=function(t,e){this._data||this._lazyInit();var i;try{i=t?a(t,this._data):this._data}catch(t){throw new Error(t)}return i!==D?i:e},b.prototype.has=function(t){if(this._data||this._lazyInit(),!t)throw new Error("a `key|path` argument should be passed into the `has` method");return o(t,this._data)?{has:k,value:a(t,this._data)}:{has:w,value:D}},b.prototype.remove=function(t){this._data||this._lazyInit(),this._backupData=this._data,t?s(t,this._data):this._data={};try{this._storage.set(this._DATA_KEY,this._data)}catch(t){throw this._storage.set(this._DATA_KEY,this._data=this._backupData),new Error(t)}},b.prototype.destroy=function(){var t=this;this._data=y,this._checkData=y,this._storage.remove(this._DATA_KEY),this._storage.remove(this._CHECK_KEY);for(var e in t.constructor.prototype)t.constructor.prototype.hasOwnProperty(e)&&(t[e]=D)},b.prototype.dump=function(){this._data||this._lazyInit(),JSON&&c&&console.log(JSON.stringify(this._data,y,4))};for(var A=["set","get","has","remove","destroy"],S=0,O=A.length;S<O;S++)!function(t,e){var i=A[t];b.prototype["async"+i.charAt(0).toUpperCase()+i.substr(1)]=function(){var t=arguments,e=this;return new Promise(function(r,n){try{r(e[i].apply(e,t))}catch(t){n(t)}})}}(S);var K={},C=function(t){return new b(t)};return C.version="2.0.1",C._variable=K,C.supportStorage=m,C.each=function(t){void 0===t&&(t=p);var e={variable:C._variable};m&&(e.localStorage=localStorage,e.sessionStorage=sessionStorage);for(var i in e)for(var r in e[i])if(r.indexOf("NSCheck:")>-1){var n=C({key:r.match(/NSCheck:(.*)/)[1],type:i});t(n)}},C.clean=function(){this.each(function(t){t.isOutdated()&&t.destroy()})},C.list=function(){this.each(function(t){c&&console.log(t.config.type,t.config.key,t.get())})},C.clean(),C});
//# sourceMappingURL=natty-storage.min.js.map
